<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime API Fetch Example</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: #e6e6e6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background-color: #16213e;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            padding: 20px;
            margin-top: 20px;
        }
        
        h2 {
            color: #ff9a3c;
            text-align: center;
            margin-bottom: 25px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        select, button {
            background-color: #0f3460;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        select {
            min-width: 120px;
        }
        
        button:hover, select:hover {
            background-color: #e94560;
        }
        
        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .anime-card {
            background-color: #0f3460;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .anime-card:hover {
            transform: translateY(-5px);
        }
        
        .anime-poster {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }
        
        .anime-info {
            padding: 12px;
        }
        
        .anime-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 8px 0;
            color: #ff9a3c;
            height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .anime-details {
            font-size: 14px;
            color: #b3b3b3;
            display: flex;
            justify-content: space-between;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #ff9a3c;
        }
        
        .error {
            color: #e94560;
            padding: 15px;
            display: none;
            text-align: center;
            background-color: rgba(233, 69, 96, 0.2);
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 25px;
            gap: 10px;
        }
        
        .page-info {
            text-align: center;
            margin-top: 15px;
            color: #b3b3b3;
        }
    </style>
</head>
<body>
    <!-- Minimal HTML -->
    <div class="container">
        <h2>Anime Explorer</h2>
        
        <div class="controls">
            <select id="sortOption">
                <option value="all">All</option>
                <option value="0-9">0-9</option>
                <option value="other">Other</option>
                <option value="a">A</option>
                <option value="b">B</option>
                <option value="c">C</option>
                <option value="d">D</option>
                <option value="e">E</option>
                <option value="f">F</option>
                <option value="g">G</option>
                <option value="h">H</option>
                <option value="i">I</option>
                <option value="j">J</option>
                <option value="k">K</option>
                <option value="l">L</option>
                <option value="m">M</option>
                <option value="n">N</option>
                <option value="o">O</option>
                <option value="p">P</option>
                <option value="q">Q</option>
                <option value="r">R</option>
                <option value="s">S</option>
                <option value="t">T</option>
                <option value="u">U</option>
                <option value="v">V</option>
                <option value="w">W</option>
                <option value="x">X</option>
                <option value="y">Y</option>
                <option value="z">Z</option>
            </select>
            <button id="fetchButton">Fetch Anime</button>
        </div>
        
        <div id="loading" class="loading">Loading anime data...</div>
        <div id="error" class="error"></div>
        <div id="animeGrid" class="anime-grid"></div>
        
        <div class="page-info" id="pageInfo"></div>
        <div class="pagination">
            <button id="prevPage" disabled>Previous</button>
            <button id="nextPage" disabled>Next</button>
        </div>
    </div>

    <!-- JavaScript for Fetch API -->
    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Get references to DOM elements
            const fetchButton = document.getElementById('fetchButton');
            const sortOption = document.getElementById('sortOption');
            const animeGrid = document.getElementById('animeGrid');
            const loadingIndicator = document.getElementById('loading');
            const errorContainer = document.getElementById('error');
            const prevPageButton = document.getElementById('prevPage');
            const nextPageButton = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');
            
            // Current page state
            let currentPage = 1;
            let totalPages = 1;
            let currentSortOption = "all";
            
            // Add click event listener to the fetch button
            fetchButton.addEventListener('click', () => {
                currentPage = 1; // Reset to page 1 when changing sort options
                currentSortOption = sortOption.value;
                fetchAnime(currentSortOption, currentPage);
            });
            
            // Add event listeners for pagination buttons
            prevPageButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    fetchAnime(currentSortOption, currentPage);
                }
            });
            
            nextPageButton.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    fetchAnime(currentSortOption, currentPage);
                }
            });
            
            // Function to fetch anime data from the API
            function fetchAnime(sortOption, page) {
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                // Hide any previous errors
                errorContainer.style.display = 'none';
                // Clear previous results
                animeGrid.innerHTML = '';
                
                // Update pagination buttons
                updatePaginationButtons();
                
                // Construct the API URL
                const apiUrl = `https://animeapi-lyart.vercel.app/api/v2/hianime/azlist/${sortOption}?page=${page}`;
                
                // Perform the fetch operation
                fetch(apiUrl)
                    .then(response => {
                        // Check if the response is ok (status in the range 200-299)
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Check if the API request was successful
                        if (data.success) {
                            // Process and display the anime data
                            displayAnimeList(data.data);
                            
                            // Update pagination state
                            totalPages = data.data.totalPages;
                            currentPage = data.data.currentPage;
                            updatePaginationInfo(currentPage, totalPages);
                            updatePaginationButtons();
                        } else {
                            throw new Error('API returned unsuccessful response');
                        }
                    })
                    .catch(error => {
                        // Handle any errors
                        console.error('Fetch error:', error);
                        errorContainer.textContent = `Failed to fetch anime data: ${error.message}`;
                        errorContainer.style.display = 'block';
                    })
                    .finally(() => {
                        // Hide loading indicator when done (success or error)
                        loadingIndicator.style.display = 'none';
                    });
            }
            
            // Function to display anime list in the grid
            function displayAnimeList(data) {
                const animes = data.animes;
                
                // If no animes found
                if (animes.length === 0) {
                    animeGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No anime found for this selection.</p>';
                    return;
                }
                
                // For each anime, create a card and add it to the grid
                animes.forEach(anime => {
                    // Create a anime card element
                    const animeCard = document.createElement('div');
                    animeCard.className = 'anime-card';
                    
                    // Use placeholder for missing posters
                    const posterUrl = anime.poster || '/api/placeholder/200/280';
                    
                    // Populate the card with anime details
                    animeCard.innerHTML = `
                        <img src="${posterUrl}" alt="${anime.name}" class="anime-poster" onerror="this.src='/api/placeholder/200/280'">
                        <div class="anime-info">
                            <h3 class="anime-title">${anime.name}</h3>
                            <div class="anime-details">
                                <span>${anime.type || 'N/A'}</span>
                                <span>Rating: ${anime.rating || 'N/A'}</span>
                            </div>
                            <div class="anime-details" style="margin-top: 5px;">
                                <span>Sub: ${anime.episodes?.sub || 'N/A'}</span>
                                <span>Dub: ${anime.episodes?.dub || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                    
                    // Add the card to the anime grid
                    animeGrid.appendChild(animeCard);
                });
            }
            
            // Function to update pagination info text
            function updatePaginationInfo(current, total) {
                pageInfo.textContent = `Page ${current} of ${total}`;
            }
            
            // Function to update pagination buttons state
            function updatePaginationButtons() {
                prevPageButton.disabled = currentPage <= 1;
                nextPageButton.disabled = currentPage >= totalPages;
            }
            
            // Fetch anime data on initial load
            fetchAnime("all", 1);
            
            // Enhanced fetch function with timeout and retry capability
            function enhancedFetch(url, options = {}) {
                // Default options
                const defaultOptions = {
                    timeout: 8000,   // 8 seconds timeout
                    retries: 2,      // Number of retry attempts
                    retryDelay: 1500 // Delay between retries in ms
                };
                
                // Merge default options with provided options
                const fetchOptions = { ...defaultOptions, ...options };
                let retriesLeft = fetchOptions.retries;

                // Create a promise that rejects after the timeout
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => {
                        reject(new Error(`Request timed out after ${fetchOptions.timeout}ms`));
                    }, fetchOptions.timeout);
                });

                // Function to attempt the fetch with retry logic
                function attemptFetch() {
                    return new Promise((resolve, reject) => {
                        // Race between fetch and timeout
                        Promise.race([
                            fetch(url, options),
                            timeoutPromise
                        ])
                        .then(resolve)
                        .catch(error => {
                            // If we have retries left, try again after delay
                            if (retriesLeft > 0) {
                                console.log(`Retrying fetch to ${url}. Retries left: ${retriesLeft}`);
                                retriesLeft--;
                                setTimeout(() => {
                                    resolve(attemptFetch());
                                }, fetchOptions.retryDelay);
                            } else {
                                // No retries left, reject with the error
                                reject(error);
                            }
                        });
                    });
                }

                // Start the fetch attempt
                return attemptFetch();
            }

            // Note: The enhancedFetch function is defined but not used.
            // To use it, replace the fetch() calls with enhancedFetch().
        });
    </script>
</body>
    </html>
