<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch API Example</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3e8e41;
        }
        
        .user-card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        
        .user-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .user-info {
            flex: 1;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .error {
            color: #f44336;
            padding: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Minimal HTML -->
    <div class="container">
        <h2>Fetch API Example</h2>
        <button id="fetchButton">Fetch Users</button>
        <div id="loading" class="loading">Loading...</div>
        <div id="error" class="error"></div>
        <div id="results"></div>
    </div>

    <!-- JavaScript for Fetch API -->
    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Get references to DOM elements
            const fetchButton = document.getElementById('fetchButton');
            const resultsContainer = document.getElementById('results');
            const loadingIndicator = document.getElementById('loading');
            const errorContainer = document.getElementById('error');

            // Add click event listener to the button
            fetchButton.addEventListener('click', fetchUsers);

            // Function to fetch users from JSONPlaceholder API
            function fetchUsers() {
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                // Hide any previous errors
                errorContainer.style.display = 'none';
                // Clear previous results
                resultsContainer.innerHTML = '';

                // Perform the fetch operation
                fetch('https://jsonplaceholder.typicode.com/users')
                    .then(response => {
                        // Check if the response is ok (status in the range 200-299)
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(users => {
                        // Process and display the users
                        displayUsers(users);
                    })
                    .catch(error => {
                        // Handle any errors
                        console.error('Fetch error:', error);
                        errorContainer.textContent = `Failed to fetch users: ${error.message}`;
                        errorContainer.style.display = 'block';
                    })
                    .finally(() => {
                        // Hide loading indicator when done (success or error)
                        loadingIndicator.style.display = 'none';
                    });
            }

            // Function to display users in the results container
            function displayUsers(users) {
                // For each user, create a card and add it to the results
                users.forEach(user => {
                    // Create a user card element
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    
                    // Generate a placeholder image (using robohash for fun avatars)
                    const imageUrl = `https://robohash.org/${user.id}?size=60x60&set=set4`;
                    
                    // Populate the card with user details
                    userCard.innerHTML = `
                        <img src="${imageUrl}" alt="User ${user.id}" class="user-image">
                        <div class="user-info">
                            <h3>${user.name}</h3>
                            <p>Email: ${user.email}</p>
                            <p>Company: ${user.company.name}</p>
                        </div>
                    `;
                    
                    // Add the card to the results container
                    resultsContainer.appendChild(userCard);
                });
            }
        });

        // Advanced example: Implement a custom fetch wrapper with timeout and retry
        function enhancedFetch(url, options = {}) {
            // Default options
            const defaultOptions = {
                timeout: 5000,  // 5 seconds timeout
                retries: 2,     // Number of retry attempts
                retryDelay: 1000 // Delay between retries in ms
            };
            
            // Merge default options with provided options
            const fetchOptions = { ...defaultOptions, ...options };
            let retriesLeft = fetchOptions.retries;

            // Create a promise that rejects after the timeout
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => {
                    reject(new Error(`Request timed out after ${fetchOptions.timeout}ms`));
                }, fetchOptions.timeout);
            });

            // Function to attempt the fetch with retry logic
            function attemptFetch() {
                return new Promise((resolve, reject) => {
                    // Race between fetch and timeout
                    Promise.race([
                        fetch(url, options),
                        timeoutPromise
                    ])
                    .then(resolve)
                    .catch(error => {
                        // If we have retries left, try again after delay
                        if (retriesLeft > 0) {
                            console.log(`Retrying fetch to ${url}. Retries left: ${retriesLeft}`);
                            retriesLeft--;
                            setTimeout(() => {
                                resolve(attemptFetch());
                            }, fetchOptions.retryDelay);
                        } else {
                            // No retries left, reject with the error
                            reject(error);
                        }
                    });
                });
            }

            // Start the fetch attempt
            return attemptFetch();
        }

        // Note: The enhancedFetch function is demonstrated but not used in this example
        // To use it, replace the fetch() call in fetchUsers with enhancedFetch()
    </script>
</body>
</html>
